/*! sakee v0.1.0 <<%= pkg.url =>>
 *  Copyright 2014 Luiz "Bills" <luizpbills@gmail.com>
 *  Licensed under MIT License
 */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.sakee=b()}(this,function(){"use strict";var a=function(){function a(){this._events={}}var b=a.prototype,c=Array.prototype.slice;return b.emit=function(a){var b;if(b=this._events[a],null==b)return!1;var d=c.call(arguments,1);if("function"==typeof b)switch(d.length){case 0:b.call(this);break;case 1:b.call(this,d[0]);break;case 2:b.call(this,d[0],d[1]);break;default:b.apply(this,d)}else for(var e=b.length,f=b.slice(),g=0;e>g;g++)f[g].apply(this,d);return!0},b.on=function(a,b){var c=this._events[a];return null==c?this._events[a]=b:"function"==typeof c?this._events[a]=[c,b]:this._events[a].push(b),this},b.once=function(a,b){function c(){this.off(a,c),d||(d=!0,b.apply(null,arguments))}var d=!1;return this.on(a,c),this},b.off=function(a,b){switch(arguments.length){case 0:this._events={};break;case 1:this._events[a]=null;break;case 2:var c=this._events[a];if(null==c)return this;if(c===b)null==this._events[a];else for(var d=c.length,e=0;d>e;e++)c[e]===b&&(1===d?this._events[a]=null:c.splice(e,1))}return this},a.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?"function"==typeof a._events[b]?1:a._events[b].length:0},a}(),b=function(){function a(){this._values={}}var b=a.prototype;return b.get=function(a){var b=this._values[a];return null!=b?b:null},b.set=function(a,b){if(a instanceof Object)for(var c in a)this._values[c]=a[c];else this._values[a]=b},b.exists=function(a){return null!=this._values[a]},b.remove=function(a){return this.exists(a)?delete this._values[a]:!1},b.keys=function(){var a=[];for(var b in this._values)this.exists(b)&&a.push(b);return a},b.toString=function(a,b){return a?JSON.stringify(this._values,null,b||"	"):JSON.stringify(this._values)},a}(),c=function(){function a(a){this.root=a,this.lastEntityId=0,this._aliveEntities=new b,this._recycledIDs=[]}var c=a.prototype;return c.create=function(a){var b=this._recycledIDs.pop()||++this.lastEntityId;if(this._aliveEntities.set(b,!0),this.root.system.emit("create entity",b),null!=a)for(var c=a.length,d=0;c>d;d++)this.root.component.get(a[d]).createData(b);return b},c.addComponent=function(a,b){var c=this.root.component.get(b);return c.createData(a)},c.getComponent=function(a,b){var c=this.root.component.get(b);return c.getData(a)},c.removeComponent=function(a,b){var c=this.root.component.get(b);return c.removeData(a)},c.hasComponent=function(a,b){var c=this.root.component.get(b);return c.hasData(a)},c.destroy=function(a){return this._aliveEntities.remove(a)?(this._recycledIDs.push(a),this.root.system.emit("destroy entity",a),!0):!1},c.exists=function(a){return this._aliveEntities.exists(a)},a}(),d=function(){function a(a){this.root=a,this._components=new b}function c(a,c,d){this.name=a,this.root=d,this._dataModel=c,this._entitiesData=new b}var d=a.prototype;return d.set=function(a,b){var a=(""+a).toLowerCase();if(this._components.exists(a))throw new Error('Component named "'+a+'" already exists.');var d=new c(a,b,this.root);return this._components.set(a,d),d},d.get=function(a){var a=(""+a).toLowerCase(),b=this._components.get(a);if(null==b)throw new Error('Component named "'+a+"\" don't exist.");return this._components.get(a)},d=c.prototype,d.createData=function(a){if(this.hasData(a))return this.getData(a);var b=this._allocData();return this._entitiesData.set(a,b),this.root.system.emit("add component",a,this.name),b},d.getData=function(a){if(!this.hasData(a))throw new Error("Entity(id="+a+") don't have component \""+this.name+'"');return this._entitiesData.get(a)},d.hasData=function(a){return this._entitiesData.exists(a)},d.removeData=function(a){return this.hasData(a)?(this._entitiesData.remove(a),this.root.system.emit("remove component",a,this.name),!0):!1},d._allocData=function(){var a;return a="function"==typeof this._dataModel?new this._dataModel:Object.create(this._dataModel)},a}(),e=function(){function c(a){this.root=a,this._systems=new b,this._priorityList={update:[],render:[]}}var d=(Array.prototype.slice,c.prototype);d.set=function(a,b){if(a=(""+a).toLowerCase(),this._systems.exists(a))throw new Error('System named "'+a+'" already exists.');var c=new e(a,b,this);return this._systems.set(a,c),this._priorityList.update.push(a),c.data.priority.update>0&&this._sortPriorityList("update"),this._priorityList.render.push(a),c.data.priority.render>0&&this._sortPriorityList("render"),c},d.get=function(a){if(a=(""+a).toLowerCase(),!this._systems.exists(a))throw new Error('System named "'+a+"\" don't exist.");return this._systems.get(a)},d.emit=function(a){var b,c,d;for(b="update"===a||"update system"===a||"update entity"===a?this._priorityList.update:this._priorityList.render,d=b.length,c=0;d>c;c++){var e=this.get(b[c]);e.emit.apply(e,arguments)}},d._sortPriorityList=function(a){var b=this._priorityList[a],c=this;b.sort(function(b,d){return c.get(d).data.priority[a]-c.get(b).data.priority[a]})};var e=function(){function b(b,c,d){a.call(this),this.name=b,this.data=c,this.manager=d,this._enabled=!0,this._entities=[],this._config()}b.prototype=new a;var c=b.prototype;return c.emit=function(){return this._enabled===!1?!1:void a.prototype.emit.apply(this,arguments)},c.enable=function(){this._enabled=!0},c.disable=function(){this._enabled=!1},c.toggle=function(){this._enabled=!this._enabled},c.isEnabled=function(){return this._enabled},c._config=function(){var a=this.data.priority;if("number"==typeof a&&(this.data.priority={update:a,render:a},a=this.data.priority),"object"==typeof a?((a.update<0||"number"!=typeof a.update)&&(a.update=0),(a.render<0||"number"!=typeof a.render)&&(a.render=0)):this.data.priority={update:0,render:0},"object"!=typeof this.data.filter)this.data.filter=!1;else for(var b in this.data.filter){var c=b.toLowerCase();this.data.filter[c]=!!this.data.filter[b],c!==b&&delete this.data.filter[b]}if(null!=this.data.events){for(var d in this.data.events)this.on(d,this.data.events[d]);this.data.events=null}this.on("create entity",this._filterEntity).on("destroy entity",this._filterEntity).on("add component",this._filterEntity).on("remove component",this._filterEntity).on("update",this._update).on("render",this._render)},c._filterEntity=function(a,b){(null==b||!this.data.filter||b in this.data.filter)&&this._verifyEntity(a,b)},c._verifyEntity=function(a,b){var c,d=this._entities.indexOf(a);if(this.manager.root.entity.exists(a)){if(this.data.filter)if(null!=b){var e=this.data.filter[b];c=e===this.manager.root.entity.hasComponent(a,b)}else{c=!0;for(b in this.data.filter){var e=this.data.filter[b];if(c=e===this.manager.root.entity.hasComponent(a,b),0==c)break}}}else c=!1;c===!0&&-1===d?(this._entities.push(a),this.emit("add entity",a)):c===!1&&-1!==d&&(this._entities.splice(d,1),this.emit("remove entity",a))},c._update=function(){var a=0,b=this._entities.length;for(this.emit("update system");b>a;a++)this.emit("update entity",this._entities[a])},c._render=function(){var a=0,b=this._entities.length;for(this.emit("render system");b>a;a++)this.emit("render entity",this._entities[a])},b}();return c}(),f={};return f.version="0.1.0",f.entity=new c(f),f.component=new d(f),f.system=new e(f),f.extension=new b,f.extension.set("string-map",b),f.extension.set("event-emitter",a),f});